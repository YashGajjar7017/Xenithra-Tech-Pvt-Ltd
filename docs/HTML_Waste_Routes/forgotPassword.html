<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password | Human Error</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/login/images/icons/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/login/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/login/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/login/fonts/iconic/css/material-design-iconic-font.min.css">
    <link rel="stylesheet" type="text/css" href="/login/vendor/animate/animate.css">
    <link rel="stylesheet" type="text/css" href="/login/vendor/css-hamburgers/hamburgers.min.css">
    <link rel="stylesheet" type="text/css" href="/login/vendor/animsition/css/animsition.min.css">
    <link rel="stylesheet" type="text/css" href="/login/vendor/select2/select2.min.css">
    <link rel="stylesheet" type="text/css" href="/login/vendor/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="/css/login/util.css">
    <link rel="stylesheet" type="text/css" href="/css/login/main.css">

</head>

<body>

    </head>

    <body>

        <div class="container py-5">
            <div class="limiter">
                <div class="container-login100" style="background-image: url('/images/login/bg-01.jpg');">
                    <div class="wrap-login100">
                        <form class="login100-form validate-form" id="forgotPasswordForm">
                            <span class="login100-form-logo">
                                <i class="zmdi zmdi-landscape"></i>
                            </span>

                            <span class="login100-form-title p-b-34 p-t-27">
                                Forgot Password
                            </span>

                            <div class="wrap-input100 validate-input" data-validate="Enter username">
                                <input class="input100 form-control" type="email" name="email"
                                    placeholder="Enter Your Email" id="email">
                                <span class="focus-input100" data-placeholder="&#xf207;"></span>
                            </div>

                            <!-- <div class="wrap-input100 validate-input" data-validate="Enter password">
                            <input class="input100" type="password" name="pass" placeholder="Password" id="password">
                            <span class="focus-input100" data-placeholder="&#xf191;"></span>
                        </div> -->

                            <div class="contact100-form-checkbox">
                                <input class="input-checkbox100" id="ckb1" type="checkbox" name="remember-me">
                                <label class="label-checkbox100" for="ckb1">
                                    <button class="login100-form-btn btn btn-primary" type="submit"
                                        id="requestResetBtn">
                                        Send Reset OTP
                                    </button>

                                    <div class="container-login100-form-btn">
                                        <button class="login100-form-btn" type="submit" id="requestResetBtn">
                                            Send Reset OTP
                                        </button>
                                    </div>

                        </form>
                        <div class="text-center p-t-90">
                            <a class="txt1" href="/Account/login">
                        </div>
                        Already login?
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div id="dropDownSelect1"></div>


        <script src="/login/vendor/jquery/jquery-3.2.1.min.js"></script>
        <script src="/login/vendor/animsition/js/animsition.min.js"></script>
        <script src="/login/vendor/bootstrap/js/popper.js"></script>
        <script src="/login/vendor/bootstrap/js/bootstrap.min.js"></script>
        <script src="/login/vendor/select2/select2.min.js"></script>
        <script src="/login/vendor/daterangepicker/moment.min.js"></script>
        <script src="/login/vendor/daterangepicker/daterangepicker.js"></script>
        <script src="/login/vendor/countdowntime/countdowntime.js"></script>

        <script>
            document.getElementById('forgotPasswordForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const email = document.getElementById('email').value;
                const robotCheck = document.getElementById('ckb1').checked;

                if (!email) {
                    alert('Please enter your email address');
                    return;
                }

                if (!robotCheck) {
                    alert('Please confirm you are not a robot');
                    return;
                }

                const requestBtn = document.getElementById('requestResetBtn');
                requestBtn.disabled = true;
                requestBtn.textContent = 'Sending...';

                try {
                    const response = await fetch('/api/otp/send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: email,
                            purpose: 'password_reset'
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        alert('Password reset OTP sent successfully! Please check your email.');
                        // Redirect to OTP page
                        window.location.href = '/Account/otp';
                    } else {
                        alert(data.error || 'Failed to send reset OTP');
                        requestBtn.disabled = false;
                        requestBtn.textContent = 'Send Reset OTP';
                    }
                } catch (error) {
                    console.error('Request error:', error);
                    alert('Failed to send reset OTP. Please try again.');
                    requestBtn.disabled = false;
                    requestBtn.textContent = 'Send Reset OTP';
                }
            });
        </script>
    </body>

</html>